<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>13 Bipartite network with R | R for Newspaper Data</title>
  <meta name="description" content="This is a book to help new and existing users find, process and analyse historical newspaper data, using the programming language R-Studio." />
  <meta name="generator" content="bookdown 0.16 and GitBook 2.6.7" />

  <meta property="og:title" content="13 Bipartite network with R | R for Newspaper Data" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a book to help new and existing users find, process and analyse historical newspaper data, using the programming language R-Studio." />
  <meta name="github-repo" content="yannryanBL/r-for-news-data" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="13 Bipartite network with R | R for Newspaper Data" />
  
  <meta name="twitter:description" content="This is a book to help new and existing users find, process and analyse historical newspaper data, using the programming language R-Studio." />
  

<meta name="author" content="Yann Ryan" />


<meta name="date" content="2019-12-20" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="ocr-and-its-problems.html"/>

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preface</a></li>
<li class="chapter" data-level="2" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>2</b> Introduction</a><ul>
<li class="chapter" data-level="2.1" data-path="introduction.html"><a href="introduction.html#short-history-of-newspapers-newspaper-digitisation"><i class="fa fa-check"></i><b>2.1</b> Short history of newspapers, newspaper digitisation?</a><ul>
<li class="chapter" data-level="2.1.1" data-path="introduction.html"><a href="introduction.html#burney-and-eebo"><i class="fa fa-check"></i><b>2.1.1</b> Burney and EEBO?</a></li>
<li class="chapter" data-level="2.1.2" data-path="introduction.html"><a href="introduction.html#jisc-1"><i class="fa fa-check"></i><b>2.1.2</b> JISC 1</a></li>
<li class="chapter" data-level="2.1.3" data-path="introduction.html"><a href="introduction.html#jisc-2"><i class="fa fa-check"></i><b>2.1.3</b> JISC 2</a></li>
<li class="chapter" data-level="2.1.4" data-path="introduction.html"><a href="introduction.html#bna"><i class="fa fa-check"></i><b>2.1.4</b> BNA</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="introduction.html"><a href="introduction.html#goals"><i class="fa fa-check"></i><b>2.2</b> Goals</a></li>
<li class="chapter" data-level="2.3" data-path="introduction.html"><a href="introduction.html#format-of-the-book---bookdown-and-github"><i class="fa fa-check"></i><b>2.3</b> Format of the book - bookdown and github</a><ul>
<li class="chapter" data-level="2.3.1" data-path="introduction.html"><a href="introduction.html#who-uses-r"><i class="fa fa-check"></i><b>2.3.1</b> Who uses R?</a></li>
<li class="chapter" data-level="2.3.2" data-path="introduction.html"><a href="introduction.html#the-tidyverse"><i class="fa fa-check"></i><b>2.3.2</b> The Tidyverse</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="introduction.html"><a href="introduction.html#sources"><i class="fa fa-check"></i><b>2.4</b> Sources</a><ul>
<li class="chapter" data-level="2.4.1" data-path="introduction.html"><a href="introduction.html#country-by-country"><i class="fa fa-check"></i><b>2.4.1</b> Country by country</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="introduction.html"><a href="introduction.html#methods"><i class="fa fa-check"></i><b>2.5</b> Methods</a><ul>
<li class="chapter" data-level="2.5.1" data-path="introduction.html"><a href="introduction.html#network-analysis-of-seventeenth-century"><i class="fa fa-check"></i><b>2.5.1</b> Network analysis of seventeenth century</a></li>
<li class="chapter" data-level="2.5.2" data-path="introduction.html"><a href="introduction.html#mapping"><i class="fa fa-check"></i><b>2.5.2</b> Mapping</a></li>
<li class="chapter" data-level="2.5.3" data-path="introduction.html"><a href="introduction.html#geocoding"><i class="fa fa-check"></i><b>2.5.3</b> Geocoding</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="introduction.html"><a href="introduction.html#text-mining"><i class="fa fa-check"></i><b>2.6</b> Text mining</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="sources-1.html"><a href="sources-1.html"><i class="fa fa-check"></i><b>3</b> Sources</a><ul>
<li class="chapter" data-level="3.1" data-path="sources-1.html"><a href="sources-1.html#uk"><i class="fa fa-check"></i><b>3.1</b> UK</a><ul>
<li class="chapter" data-level="3.1.1" data-path="sources-1.html"><a href="sources-1.html#british-newspaper-archive"><i class="fa fa-check"></i><b>3.1.1</b> British newspaper archive</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="sources-1.html"><a href="sources-1.html#outside-uk"><i class="fa fa-check"></i><b>3.2</b> Outside UK:</a><ul>
<li class="chapter" data-level="3.2.1" data-path="sources-1.html"><a href="sources-1.html#chronicling-america"><i class="fa fa-check"></i><b>3.2.1</b> Chronicling America</a></li>
<li class="chapter" data-level="3.2.2" data-path="sources-1.html"><a href="sources-1.html#delpher"><i class="fa fa-check"></i><b>3.2.2</b> Delpher</a></li>
<li class="chapter" data-level="3.2.3" data-path="sources-1.html"><a href="sources-1.html#eluxemburgensia"><i class="fa fa-check"></i><b>3.2.3</b> Eluxemburgensia</a></li>
<li class="chapter" data-level="3.2.4" data-path="sources-1.html"><a href="sources-1.html#europeana"><i class="fa fa-check"></i><b>3.2.4</b> Europeana</a></li>
<li class="chapter" data-level="3.2.5" data-path="sources-1.html"><a href="sources-1.html#finnish-newspaper-database"><i class="fa fa-check"></i><b>3.2.5</b> Finnish Newspaper Database</a></li>
<li class="chapter" data-level="3.2.6" data-path="sources-1.html"><a href="sources-1.html#gallica"><i class="fa fa-check"></i><b>3.2.6</b> Gallica</a></li>
<li class="chapter" data-level="3.2.7" data-path="sources-1.html"><a href="sources-1.html#trove"><i class="fa fa-check"></i><b>3.2.7</b> Trove</a></li>
<li class="chapter" data-level="3.2.8" data-path="sources-1.html"><a href="sources-1.html#papers-past"><i class="fa fa-check"></i><b>3.2.8</b> Papers Past</a></li>
<li class="chapter" data-level="3.2.9" data-path="sources-1.html"><a href="sources-1.html#hemeroteca-nacional-digital-de-mexico"><i class="fa fa-check"></i><b>3.2.9</b> Hemeroteca Nacional Digital de Mexico</a></li>
<li class="chapter" data-level="3.2.10" data-path="sources-1.html"><a href="sources-1.html#belgica-press"><i class="fa fa-check"></i><b>3.2.10</b> Belgica Press</a></li>
<li class="chapter" data-level="3.2.11" data-path="sources-1.html"><a href="sources-1.html#welsh-newspaper-archive"><i class="fa fa-check"></i><b>3.2.11</b> Welsh Newspaper Archive</a></li>
<li class="chapter" data-level="3.2.12" data-path="sources-1.html"><a href="sources-1.html#national-library-of-scotland"><i class="fa fa-check"></i><b>3.2.12</b> National Library of Scotland</a></li>
<li class="chapter" data-level="3.2.13" data-path="sources-1.html"><a href="sources-1.html#italian-newspapers"><i class="fa fa-check"></i><b>3.2.13</b> Italian newspapers</a></li>
<li class="chapter" data-level="3.2.14" data-path="sources-1.html"><a href="sources-1.html#hemeroteca-digital-spain"><i class="fa fa-check"></i><b>3.2.14</b> Hemeroteca Digital (Spain)</a></li>
<li class="chapter" data-level="3.2.15" data-path="sources-1.html"><a href="sources-1.html#anno---austrian-newspapers-online"><i class="fa fa-check"></i><b>3.2.15</b> ANNO - Austrian Newspapers Online</a></li>
<li class="chapter" data-level="3.2.16" data-path="sources-1.html"><a href="sources-1.html#bc-historical-newspapers"><i class="fa fa-check"></i><b>3.2.16</b> BC Historical Newspapers</a></li>
<li class="chapter" data-level="3.2.17" data-path="sources-1.html"><a href="sources-1.html#media-stream"><i class="fa fa-check"></i><b>3.2.17</b> Media Stream</a></li>
<li class="chapter" data-level="3.2.18" data-path="sources-1.html"><a href="sources-1.html#stare-hrvatske-novine"><i class="fa fa-check"></i><b>3.2.18</b> Stare hrvatske novine</a></li>
<li class="chapter" data-level="3.2.19" data-path="sources-1.html"><a href="sources-1.html#zefys"><i class="fa fa-check"></i><b>3.2.19</b> ZEFYS</a></li>
<li class="chapter" data-level="3.2.20" data-path="sources-1.html"><a href="sources-1.html#timarit.is"><i class="fa fa-check"></i><b>3.2.20</b> Timarit.is</a></li>
<li class="chapter" data-level="3.2.21" data-path="sources-1.html"><a href="sources-1.html#google-news-archive"><i class="fa fa-check"></i><b>3.2.21</b> Google news archive</a></li>
<li class="chapter" data-level="3.2.22" data-path="sources-1.html"><a href="sources-1.html#baltic-digital-library"><i class="fa fa-check"></i><b>3.2.22</b> Baltic Digital Library</a></li>
<li class="chapter" data-level="3.2.23" data-path="sources-1.html"><a href="sources-1.html#newspapersg"><i class="fa fa-check"></i><b>3.2.23</b> NewspaperSG</a></li>
<li class="chapter" data-level="3.2.24" data-path="sources-1.html"><a href="sources-1.html#svenska-dagstidningar"><i class="fa fa-check"></i><b>3.2.24</b> Svenska dagstidningar</a></li>
<li class="chapter" data-level="3.2.25" data-path="sources-1.html"><a href="sources-1.html#handwritten-newspapers-project"><i class="fa fa-check"></i><b>3.2.25</b> Handwritten Newspapers Project</a></li>
<li class="chapter" data-level="3.2.26" data-path="sources-1.html"><a href="sources-1.html#the-medici-archive-project"><i class="fa fa-check"></i><b>3.2.26</b> The Medici Archive Project</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="methods-1.html"><a href="methods-1.html"><i class="fa fa-check"></i><b>4</b> Methods</a><ul>
<li class="chapter" data-level="4.1" data-path="methods-1.html"><a href="methods-1.html#mapping-seventeenth-century-newsbooks"><i class="fa fa-check"></i><b>4.1</b> Mapping seventeenth century newsbooks</a><ul>
<li class="chapter" data-level="4.1.1" data-path="methods-1.html"><a href="methods-1.html#mapping-with-r"><i class="fa fa-check"></i><b>4.1.1</b> Mapping with R</a></li>
<li class="chapter" data-level="4.1.2" data-path="methods-1.html"><a href="methods-1.html#steps"><i class="fa fa-check"></i><b>4.1.2</b> Steps</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="methods-1.html"><a href="methods-1.html#network-analysis-of-seventeenth-century-newsbooks"><i class="fa fa-check"></i><b>4.2</b> Network analysis of seventeenth century newsbooks</a><ul>
<li class="chapter" data-level="4.2.1" data-path="methods-1.html"><a href="methods-1.html#background"><i class="fa fa-check"></i><b>4.2.1</b> Background</a></li>
<li class="chapter" data-level="4.2.2" data-path="methods-1.html"><a href="methods-1.html#network-analysis"><i class="fa fa-check"></i><b>4.2.2</b> Network analysis</a></li>
<li class="chapter" data-level="4.2.3" data-path="methods-1.html"><a href="methods-1.html#steps-1"><i class="fa fa-check"></i><b>4.2.3</b> Steps</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="methods-1.html"><a href="methods-1.html#network-analysis-using-nlp-and-lancaster-newsbooks"><i class="fa fa-check"></i><b>4.3</b> Network analysis using NLP and Lancaster newsbooks</a><ul>
<li class="chapter" data-level="4.3.1" data-path="methods-1.html"><a href="methods-1.html#background-1"><i class="fa fa-check"></i><b>4.3.1</b> Background</a></li>
<li class="chapter" data-level="4.3.2" data-path="methods-1.html"><a href="methods-1.html#sources-used"><i class="fa fa-check"></i><b>4.3.2</b> Sources used</a></li>
<li class="chapter" data-level="4.3.3" data-path="methods-1.html"><a href="methods-1.html#steps-2"><i class="fa fa-check"></i><b>4.3.3</b> Steps</a></li>
<li class="chapter" data-level="4.3.4" data-path="methods-1.html"><a href="methods-1.html#choropleth-maps---nineteenth-century"><i class="fa fa-check"></i><b>4.3.4</b> Choropleth maps - nineteenth century</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="data.html"><a href="data.html"><i class="fa fa-check"></i><b>5</b> Data</a><ul>
<li class="chapter" data-level="5.1" data-path="data.html"><a href="data.html#intro-to-british-library-newspapers"><i class="fa fa-check"></i><b>5.1</b> Intro to British Library Newspapers</a></li>
<li class="chapter" data-level="5.2" data-path="data.html"><a href="data.html#jisc-newspaper-digitisation-projects"><i class="fa fa-check"></i><b>5.2</b> JISC Newspaper digitisation projects</a></li>
<li class="chapter" data-level="5.3" data-path="data.html"><a href="data.html#british-newspaper-archive-1"><i class="fa fa-check"></i><b>5.3</b> BRITISH NEWSPAPER ARCHIVE</a></li>
<li class="chapter" data-level="5.4" data-path="data.html"><a href="data.html#gale"><i class="fa fa-check"></i><b>5.4</b> GALE</a><ul>
<li class="chapter" data-level="5.4.1" data-path="data.html"><a href="data.html#getting-access-to-gale-data---experience-of-others"><i class="fa fa-check"></i><b>5.4.1</b> Getting access to GALE data - experience of others</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="data.html"><a href="data.html#hmd-data--on-repository"><i class="fa fa-check"></i><b>5.5</b> HMD data- on repository</a><ul>
<li class="chapter" data-level="5.5.1" data-path="data.html"><a href="data.html#project-goals"><i class="fa fa-check"></i><b>5.5.1</b> Project goals</a></li>
<li class="chapter" data-level="5.5.2" data-path="data.html"><a href="data.html#whats-available"><i class="fa fa-check"></i><b>5.5.2</b> What’s available</a></li>
<li class="chapter" data-level="5.5.3" data-path="data.html"><a href="data.html#xml-flavour"><i class="fa fa-check"></i><b>5.5.3</b> XML flavour</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="data.html"><a href="data.html#luxembourg-data"><i class="fa fa-check"></i><b>5.6</b> Luxembourg data</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="data-formats.html"><a href="data-formats.html"><i class="fa fa-check"></i><b>6</b> Data formats</a><ul>
<li class="chapter" data-level="6.1" data-path="data-formats.html"><a href="data-formats.html#xml---different-flavours"><i class="fa fa-check"></i><b>6.1</b> XML - different flavours</a></li>
<li class="chapter" data-level="6.2" data-path="data-formats.html"><a href="data-formats.html#full-text-transcriptions---like-the-lancaster-corpus"><i class="fa fa-check"></i><b>6.2</b> Full-text transcriptions - like the Lancaster Corpus</a></li>
<li class="chapter" data-level="6.3" data-path="data-formats.html"><a href="data-formats.html#cqpweb-newspaper-corpora"><i class="fa fa-check"></i><b>6.3</b> CQPWeb newspaper corpora</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="data-formats-1.html"><a href="data-formats-1.html"><i class="fa fa-check"></i><b>7</b> Data formats</a><ul>
<li class="chapter" data-level="7.1" data-path="data-formats-1.html"><a href="data-formats-1.html#xml---different-flavours-1"><i class="fa fa-check"></i><b>7.1</b> XML - different flavours</a></li>
<li class="chapter" data-level="7.2" data-path="data-formats-1.html"><a href="data-formats-1.html#full-text-transcriptions"><i class="fa fa-check"></i><b>7.2</b> Full-text transcriptions</a></li>
<li class="chapter" data-level="7.3" data-path="data-formats-1.html"><a href="data-formats-1.html#where-to-find-help"><i class="fa fa-check"></i><b>7.3</b> Where to find help:</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="existing-work.html"><a href="existing-work.html"><i class="fa fa-check"></i><b>8</b> Existing work</a></li>
<li class="chapter" data-level="9" data-path="text-mining-1.html"><a href="text-mining-1.html"><i class="fa fa-check"></i><b>9</b> Text mining</a><ul>
<li class="chapter" data-level="9.1" data-path="text-mining-1.html"><a href="text-mining-1.html#what-were-the-most-common-words-used-in-newspaper-titles-in-the-nineteenth-century_"><i class="fa fa-check"></i><b>9.1</b> What were the most common words used in newspaper titles in the nineteenth century?_</a><ul>
<li class="chapter" data-level="9.1.1" data-path="text-mining-1.html"><a href="text-mining-1.html#titles-dont-just-help-you-identity-a-newspaper-but-they-might-tell-you-a-little-bit-about-the-time-in-which-they-were-established.-with-a-bibliographic-list-of-all-our-uk-and-irish-titles-we-can-count-the-most-frequent-words-and-track-them-over-time-and-place-using-text-mining-and-data-analysis."><i class="fa fa-check"></i><b>9.1.1</b> Titles don’t just help you identity a newspaper, but they might tell you a little bit about the time in which they were established. With a bibliographic list of <em>all</em> our UK and Irish titles, we can count the most frequent words and track them over time and place, using text mining and data analysis.</a></li>
<li class="chapter" data-level="9.1.2" data-path="text-mining-1.html"><a href="text-mining-1.html#what-is-this-document"><i class="fa fa-check"></i><b>9.1.2</b> What is this document?</a></li>
<li class="chapter" data-level="9.1.3" data-path="text-mining-1.html"><a href="text-mining-1.html#how-about-differences-by-country"><i class="fa fa-check"></i><b>9.1.3</b> How about differences by country?</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="how-to-use-this-book.html"><a href="how-to-use-this-book.html"><i class="fa fa-check"></i><b>10</b> How to use this book</a><ul>
<li class="chapter" data-level="10.1" data-path="how-to-use-this-book.html"><a href="how-to-use-this-book.html#what-is-this"><i class="fa fa-check"></i><b>10.1</b> What is this?</a></li>
<li class="chapter" data-level="10.2" data-path="how-to-use-this-book.html"><a href="how-to-use-this-book.html#download-r-and-r-studio"><i class="fa fa-check"></i><b>10.2</b> Download R and R-Studio</a></li>
<li class="chapter" data-level="10.3" data-path="how-to-use-this-book.html"><a href="how-to-use-this-book.html#download-a-copy"><i class="fa fa-check"></i><b>10.3</b> Download a copy</a></li>
<li class="chapter" data-level="10.4" data-path="how-to-use-this-book.html"><a href="how-to-use-this-book.html#licence-terms"><i class="fa fa-check"></i><b>10.4</b> Licence terms</a></li>
<li class="chapter" data-level="10.5" data-path="how-to-use-this-book.html"><a href="how-to-use-this-book.html#clone-a-copy-to-github"><i class="fa fa-check"></i><b>10.5</b> Clone a copy to GitHub</a></li>
<li class="chapter" data-level="10.6" data-path="how-to-use-this-book.html"><a href="how-to-use-this-book.html#make-your-own-version"><i class="fa fa-check"></i><b>10.6</b> Make your own version</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="r-and-the-tidyverse.html"><a href="r-and-the-tidyverse.html"><i class="fa fa-check"></i><b>11</b> R and the Tidyverse</a><ul>
<li class="chapter" data-level="11.1" data-path="r-and-the-tidyverse.html"><a href="r-and-the-tidyverse.html#r"><i class="fa fa-check"></i><b>11.1</b> R</a><ul>
<li class="chapter" data-level="11.1.1" data-path="r-and-the-tidyverse.html"><a href="r-and-the-tidyverse.html#base-r-commands"><i class="fa fa-check"></i><b>11.1.1</b> Base R commands</a></li>
<li class="chapter" data-level="11.1.2" data-path="r-and-the-tidyverse.html"><a href="r-and-the-tidyverse.html#r-studio"><i class="fa fa-check"></i><b>11.1.2</b> R studio</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="r-and-the-tidyverse.html"><a href="r-and-the-tidyverse.html#tidyverse"><i class="fa fa-check"></i><b>11.2</b> Tidyverse</a><ul>
<li class="chapter" data-level="11.2.1" data-path="r-and-the-tidyverse.html"><a href="r-and-the-tidyverse.html#select-pull"><i class="fa fa-check"></i><b>11.2.1</b> Select, pull</a></li>
<li class="chapter" data-level="11.2.2" data-path="r-and-the-tidyverse.html"><a href="r-and-the-tidyverse.html#group_by-tally-summarise"><i class="fa fa-check"></i><b>11.2.2</b> group_by, tally, summarise</a></li>
<li class="chapter" data-level="11.2.3" data-path="r-and-the-tidyverse.html"><a href="r-and-the-tidyverse.html#filter"><i class="fa fa-check"></i><b>11.2.3</b> filter</a></li>
<li class="chapter" data-level="11.2.4" data-path="r-and-the-tidyverse.html"><a href="r-and-the-tidyverse.html#sort-arrange-top_n"><i class="fa fa-check"></i><b>11.2.4</b> sort, arrange, top_n</a></li>
<li class="chapter" data-level="11.2.5" data-path="r-and-the-tidyverse.html"><a href="r-and-the-tidyverse.html#piping"><i class="fa fa-check"></i><b>11.2.5</b> Piping</a></li>
<li class="chapter" data-level="11.2.6" data-path="r-and-the-tidyverse.html"><a href="r-and-the-tidyverse.html#plotting"><i class="fa fa-check"></i><b>11.2.6</b> Plotting</a></li>
<li class="chapter" data-level="11.2.7" data-path="r-and-the-tidyverse.html"><a href="r-and-the-tidyverse.html#doing-this-with-newspaper-data"><i class="fa fa-check"></i><b>11.2.7</b> Doing this with newspaper data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="ocr-and-its-problems.html"><a href="ocr-and-its-problems.html"><i class="fa fa-check"></i><b>12</b> OCR and its problems</a><ul>
<li class="chapter" data-level="12.1" data-path="ocr-and-its-problems.html"><a href="ocr-and-its-problems.html#what-is-ocr"><i class="fa fa-check"></i><b>12.1</b> What is OCR?</a></li>
<li class="chapter" data-level="12.2" data-path="ocr-and-its-problems.html"><a href="ocr-and-its-problems.html#what-is-it-like-in-bl-newspapers"><i class="fa fa-check"></i><b>12.2</b> What is it like in BL newspapers?</a></li>
<li class="chapter" data-level="12.3" data-path="ocr-and-its-problems.html"><a href="ocr-and-its-problems.html#impact-on-analysis"><i class="fa fa-check"></i><b>12.3</b> Impact on analysis</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="bipartite-network-with-r.html"><a href="bipartite-network-with-r.html"><i class="fa fa-check"></i><b>13</b> Bipartite network with R</a><ul>
<li class="chapter" data-level="13.0.1" data-path="bipartite-network-with-r.html"><a href="bipartite-network-with-r.html#can-newsbooks-tell-us-something-about-they-way-place-was-organised-in-the-seventeenth-century"><i class="fa fa-check"></i><b>13.0.1</b> Can newsbooks tell us something about they way place was organised in the seventeenth century?</a></li>
<li class="chapter" data-level="13.0.2" data-path="bipartite-network-with-r.html"><a href="bipartite-network-with-r.html#background-2"><i class="fa fa-check"></i><b>13.0.2</b> Background</a></li>
<li class="chapter" data-level="13.0.3" data-path="bipartite-network-with-r.html"><a href="bipartite-network-with-r.html#bulk-geoparsing"><i class="fa fa-check"></i><b>13.0.3</b> Bulk geoparsing</a></li>
<li class="chapter" data-level="13.0.4" data-path="bipartite-network-with-r.html"><a href="bipartite-network-with-r.html#mapping-locations"><i class="fa fa-check"></i><b>13.0.4</b> Mapping locations</a></li>
<li class="chapter" data-level="13.1" data-path="bipartite-network-with-r.html"><a href="bipartite-network-with-r.html#bipartite-network"><i class="fa fa-check"></i><b>13.1</b> Bipartite network</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R for Newspaper Data</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="bipartite-network-with-r" class="section level1">
<h1><span class="header-section-number">13</span> Bipartite network with R</h1>
<div id="can-newsbooks-tell-us-something-about-they-way-place-was-organised-in-the-seventeenth-century" class="section level3">
<h3><span class="header-section-number">13.0.1</span> Can newsbooks tell us something about they way place was organised in the seventeenth century?</h3>
<div class="figure">
<img src="00003.000.001.jpg" alt="Copyright JISC/British Library" />
<p class="caption">Copyright JISC/British Library</p>
</div>
</div>
<div id="background-2" class="section level3">
<h3><span class="header-section-number">13.0.2</span> Background</h3>
<p>I’ve written elsewhere about how until the end of the seventeenth century, news was written in paragraphs. In the sample page above you can see that the paragraphs start with a place dispatch, and some of them contain news from other places. If you look at the paragraph ‘From <em>Hamburg</em>, April 12 stilo novo’ on the second page, you’ll see that the paragraph contains news ‘from Denmark’. News from Denmark was being sent to Hamburg. I spent much of my PhD research looking for these connections, because I think they tell you a lot about information flow.</p>
<p>Here I describe a <em>bipartite</em> network, meaning that places are connected if they share the same paragraph - but we need a) a list of places to work with and b) some way of filtering out so we only get the headers and then text preceded by ‘from’.</p>
<p>These are the steps:</p>
<ul>
<li>Download the Lancaster newsbook corpus</li>
<li>Turn it into plain text, and run it through the Edinburgh geoparser to get a list of places</li>
<li>Generate a list of all places found by the geoparser</li>
<li>Go back to the original files, add all the places found, organised by paragraph</li>
<li>In R, use this to make a bipartite network, where the edges are a shared paragraph.</li>
</ul>
<p>I’ve done all this in a markdown document which contains both Python and R, but to be completely reproducible it requires downloading a piece of software called the Edinburgh geoparser and running a shell script. I’ve included this as text instructions rather than code.</p>
<p>Make sure we load Python3 and not 2:</p>
<p>Download the Lancaster newsbook corpus from here: <a href="https://ota.ox.ac.uk/id/2531" class="uri">https://ota.ox.ac.uk/id/2531</a></p>
<p>It’s a set of newsbooks transcribed using the TEI standard.</p>
<p>First we need to turn all the .xml files into plain text (python):</p>
<p>We’ll use the BeautifulSoup library and Python to process the .xml:</p>
<p>This lets us run Python in R markdown:</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb105-1" data-line-number="1"><span class="kw">library</span>(reticulate)</a></code></pre></div>
<p>Download the Edinburgh Geoparser: <a href="https://www.ltg.ed.ac.uk/software/geoparser/" class="uri">https://www.ltg.ed.ac.uk/software/geoparser/</a> and put it in your project folder.</p>
<p>This makes sure that we run python3 and not 2:</p>
<p>Use beautifulSoup to process the .xml into plain text, and put them in the ‘in’ folder of the Edinburgh geoparser.</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb106-1" data-line-number="1"><span class="im">from</span> bs4 <span class="im">import</span> BeautifulSoup</a>
<a class="sourceLine" id="cb106-2" data-line-number="2"><span class="im">import</span> glob</a>
<a class="sourceLine" id="cb106-3" data-line-number="3">all_files <span class="op">=</span> glob.glob(<span class="st">&quot;/Users/yannryan/Desktop/r-projects/r-for-news-data/data/1654_newsbooks/*.xml&quot;</span>)</a>
<a class="sourceLine" id="cb106-4" data-line-number="4"><span class="cf">for</span> n, <span class="bu">file</span> <span class="kw">in</span> <span class="bu">enumerate</span>((all_files)):</a>
<a class="sourceLine" id="cb106-5" data-line-number="5">    <span class="cf">with</span> <span class="bu">open</span>(<span class="st">&quot;/Users/yannryan/Desktop/r-projects/r-for-news-data/geoparser-v1.1/in/file</span><span class="sc">{}</span><span class="st">.txt&quot;</span>.<span class="bu">format</span>(n),<span class="st">&quot;a+&quot;</span>) <span class="im">as</span> f:</a>
<a class="sourceLine" id="cb106-6" data-line-number="6">        infile <span class="op">=</span> <span class="bu">open</span>(<span class="bu">file</span>, encoding <span class="op">=</span> <span class="st">&#39;latin1&#39;</span>).read()</a>
<a class="sourceLine" id="cb106-7" data-line-number="7">        soup <span class="op">=</span> BeautifulSoup(infile)</a>
<a class="sourceLine" id="cb106-8" data-line-number="8">        <span class="bu">print</span>(soup.text, <span class="bu">file</span> <span class="op">=</span> f)</a></code></pre></div>
</div>
<div id="bulk-geoparsing" class="section level3">
<h3><span class="header-section-number">13.0.3</span> Bulk geoparsing</h3>
<p>To bulk geoparse the text files, follow the instructions here: <a href="https://programminghistorian.org/en/lessons/geoparsing-text-with-edinburgh#geo-parsing-multiple-text-files" class="uri">https://programminghistorian.org/en/lessons/geoparsing-text-with-edinburgh#geo-parsing-multiple-text-files</a></p>
<p>Download the shell script: <a href="http://groups.inf.ed.ac.uk/geoparser/scripts/run-multiple-files.sh" class="uri">http://groups.inf.ed.ac.uk/geoparser/scripts/run-multiple-files.sh</a> and put it in the scripts folder.</p>
<p>Open the script and change settings to the following - this uses the geonames dataset, and it gives a bounding box around Europe, within which the geoparser will try to find the places first.</p>
<p><code>cat $i | ./run -t plain -g geonames -o $outputdirname $prefix -lb 27.3 68.5 52.2 34.3 10</code></p>
<p>Next we set the path to point to bash instead of Python.</p>
<p>Navigate to the scripts folder, and run the script. It takes some time, so I’ve only done a small number of files to demonstrate.</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb107-1" data-line-number="1"><span class="bu">cd</span> geoparser-v1.1</a>
<a class="sourceLine" id="cb107-2" data-line-number="2"><span class="bu">cd</span> scripts</a>
<a class="sourceLine" id="cb107-3" data-line-number="3"><span class="ex">./run-multiple-files.sh</span> -i ../in -o ../out</a></code></pre></div>
<pre><code>## Processing ../in/file0.txt
## Processing ../in/file1.txt
## Processing ../in/file2.txt
## Processing ../in/file3.txt
## Processing ../in/file4.txt</code></pre>
<p>This gives us a lot of files. One ends in .gaz.xml, and just lists each of the places in very simple XML. We can go back to the files at a later point and get coordinates, but just the place names will do for now.</p>
<p>We want a list of places to then feed back into the Lancaster .xml which has paragraph information.</p>
<p>This code below creates the list of places, including coordinates, from the Edinburgh geoparser:</p>
<p>First back to Python:</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb109-1" data-line-number="1"><span class="im">from</span> bs4 <span class="im">import</span> BeautifulSoup</a>
<a class="sourceLine" id="cb109-2" data-line-number="2"><span class="im">import</span> glob</a>
<a class="sourceLine" id="cb109-3" data-line-number="3"></a>
<a class="sourceLine" id="cb109-4" data-line-number="4">read_gaz_files <span class="op">=</span> glob.glob(<span class="st">&quot;/Users/yannryan/Desktop/r-projects/r-for-news-data/geoparser-v1.1/out/file*.gaz.xml&quot;</span>)</a>
<a class="sourceLine" id="cb109-5" data-line-number="5"></a>
<a class="sourceLine" id="cb109-6" data-line-number="6">outputfile <span class="op">=</span> <span class="bu">open</span>(<span class="st">&#39;geoparsedfiles_b.tsv&#39;</span>, <span class="st">&#39;w&#39;</span>)</a>
<a class="sourceLine" id="cb109-7" data-line-number="7"><span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> read_gaz_files:</a>
<a class="sourceLine" id="cb109-8" data-line-number="8">    xml <span class="op">=</span> <span class="bu">open</span>(<span class="bu">file</span>).read()</a>
<a class="sourceLine" id="cb109-9" data-line-number="9">    soup <span class="op">=</span> BeautifulSoup(xml)</a>
<a class="sourceLine" id="cb109-10" data-line-number="10">    <span class="cf">for</span> place <span class="kw">in</span> soup.find_all(<span class="st">&#39;place&#39;</span>):</a>
<a class="sourceLine" id="cb109-11" data-line-number="11">        <span class="cf">if</span> place[<span class="st">&#39;clusteriness_rank&#39;</span>] <span class="op">==</span> <span class="st">&quot;1&quot;</span>:</a>
<a class="sourceLine" id="cb109-12" data-line-number="12">           <span class="bu">print</span>(place[<span class="st">&#39;name&#39;</span>] <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\t</span><span class="st">&#39;</span> <span class="op">+</span> place[<span class="st">&#39;lat&#39;</span>] <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\t</span><span class="st">&#39;</span> <span class="op">+</span> place[<span class="st">&#39;long&#39;</span>], <span class="bu">file</span> <span class="op">=</span> outputfile)</a></code></pre></div>
<p>This next bit is in R, because I haven’t got around to learning proper data wrangling in python yet.</p>
<p>Load some R libraries we’ll use:</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb110-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a></code></pre></div>
<p>Load the file from R, change the column names. Ok this bit might be a bit pointless.</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb111-1" data-line-number="1">geoparsedfiles &lt;-<span class="st"> </span><span class="kw">read.delim</span>(<span class="st">&quot;geoparsedfiles.tsv&quot;</span>, <span class="dt">header=</span><span class="ot">FALSE</span>, <span class="dt">encoding =</span> <span class="st">&#39;Latin1&#39;</span>)</a>
<a class="sourceLine" id="cb111-2" data-line-number="2"></a>
<a class="sourceLine" id="cb111-3" data-line-number="3"><span class="kw">colnames</span>(geoparsedfiles) =<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;place&#39;</span>, <span class="st">&#39;lat&#39;</span>, <span class="st">&#39;lng&#39;</span>)</a></code></pre></div>
<p>Write it back to a .csv for python (sorry)</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb112-1" data-line-number="1">geoparsedfiles <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">write.csv</span>(<span class="st">&quot;places_foreign.csv&quot;</span>)</a></code></pre></div>
<p>Using the list of places from the Edinburgh geoparser, we go through all the original Lancaster newsbook files and add places, as well as a unique code for each paragraph:</p>
<p>It uses the BeautifulSoup library to parse the XML.</p>
<p>Basically this next code:</p>
<ul>
<li>checks the first and second word of each paragraph, and if they are in our list of places found by Edinburgh, it prints them, along with a unique paragraph code, and the newspaper issue filename.</li>
<li>Checks through each word in each paragraph, and any time it finds ‘from’, it prints out the <em>following</em> word, and again, the unique code and filename.</li>
</ul>
<div class="sourceCode" id="cb113"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb113-1" data-line-number="1"><span class="im">from</span> bs4 <span class="im">import</span> BeautifulSoup</a>
<a class="sourceLine" id="cb113-2" data-line-number="2"><span class="im">import</span> glob</a>
<a class="sourceLine" id="cb113-3" data-line-number="3"></a>
<a class="sourceLine" id="cb113-4" data-line-number="4"><span class="im">from</span> csv <span class="im">import</span> DictReader <span class="co"># Make a list of every place found by Edinburgh geoparser</span></a>
<a class="sourceLine" id="cb113-5" data-line-number="5"><span class="cf">with</span> <span class="bu">open</span>(<span class="st">&quot;places_foreign.csv&quot;</span>) <span class="im">as</span> f:</a>
<a class="sourceLine" id="cb113-6" data-line-number="6">    cityList <span class="op">=</span> [row[<span class="st">&quot;place&quot;</span>] <span class="cf">for</span> row <span class="kw">in</span> DictReader(f)]</a>
<a class="sourceLine" id="cb113-7" data-line-number="7"></a>
<a class="sourceLine" id="cb113-8" data-line-number="8">cityList <span class="op">=</span> [x.lower() <span class="cf">for</span> x <span class="kw">in</span> cityList]</a>
<a class="sourceLine" id="cb113-9" data-line-number="9">index_int <span class="op">=</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb113-10" data-line-number="10"></a>
<a class="sourceLine" id="cb113-11" data-line-number="11"></a>
<a class="sourceLine" id="cb113-12" data-line-number="12">all_files <span class="op">=</span> glob.glob(<span class="st">&quot;./data/1654_newsbooks/*.xml&quot;</span>)</a>
<a class="sourceLine" id="cb113-13" data-line-number="13"><span class="bu">print</span>(all_files)</a></code></pre></div>
<pre><code>## [&#39;./data/1654_newsbooks/PerfDiurn220.xml&#39;, &#39;./data/1654_newsbooks/PerfDiurn221.xml&#39;, &#39;./data/1654_newsbooks/PerfDiurn223.xml&#39;, &#39;./data/1654_newsbooks/PerfDiurn222.xml&#39;, &#39;./data/1654_newsbooks/PerfDiurn218.xml&#39;]</code></pre>
<div class="sourceCode" id="cb115"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb115-1" data-line-number="1">log <span class="op">=</span> <span class="bu">open</span>(<span class="st">&#39;paragraphs_foreign_c.tsv&#39;</span>, <span class="st">&#39;w&#39;</span>)</a>
<a class="sourceLine" id="cb115-2" data-line-number="2"></a>
<a class="sourceLine" id="cb115-3" data-line-number="3"><span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> all_files:</a>
<a class="sourceLine" id="cb115-4" data-line-number="4">    newsbook <span class="op">=</span> <span class="bu">open</span>(<span class="bu">file</span>, encoding <span class="op">=</span> <span class="st">&#39;latin1&#39;</span>).read()</a>
<a class="sourceLine" id="cb115-5" data-line-number="5">    soup <span class="op">=</span> BeautifulSoup(newsbook)</a>
<a class="sourceLine" id="cb115-6" data-line-number="6">    <span class="cf">for</span> link <span class="kw">in</span> soup.find_all(<span class="st">&#39;p&#39;</span>):</a>
<a class="sourceLine" id="cb115-7" data-line-number="7">        paragraph_list <span class="op">=</span> []</a>
<a class="sourceLine" id="cb115-8" data-line-number="8">        paragraph_list.append(link.text)</a>
<a class="sourceLine" id="cb115-9" data-line-number="9">        <span class="cf">try</span>:</a>
<a class="sourceLine" id="cb115-10" data-line-number="10">            <span class="cf">for</span> paragraph <span class="kw">in</span> paragraph_list:</a>
<a class="sourceLine" id="cb115-11" data-line-number="11">                    index_int <span class="op">+=</span><span class="dv">1</span></a>
<a class="sourceLine" id="cb115-12" data-line-number="12">                    lower_list <span class="op">=</span> [x.lower() <span class="cf">for</span> x <span class="kw">in</span> paragraph.split(<span class="st">&#39; &#39;</span>)]</a>
<a class="sourceLine" id="cb115-13" data-line-number="13">                    <span class="cf">if</span> lower_list[<span class="dv">0</span>] <span class="kw">in</span> cityList:</a>
<a class="sourceLine" id="cb115-14" data-line-number="14">                        <span class="bu">print</span>(lower_list[<span class="dv">0</span>]<span class="op">+</span> <span class="st">&#39;</span><span class="ch">\t</span><span class="st">&#39;</span> <span class="op">+</span> <span class="bu">str</span>(index_int) <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\t</span><span class="st">&#39;</span> <span class="op">+</span> <span class="bu">file</span>[<span class="dv">22</span>:<span class="op">-</span><span class="dv">4</span>] <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\t</span><span class="st">&#39;</span> <span class="op">+</span> <span class="st">&#39;x&#39;</span> <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\t</span><span class="st">&#39;</span> <span class="op">+</span> <span class="st">&#39;header&#39;</span>, <span class="bu">file</span> <span class="op">=</span> log)</a>
<a class="sourceLine" id="cb115-15" data-line-number="15">                    <span class="cf">elif</span> lower_list[<span class="dv">1</span>] <span class="kw">in</span> cityList:</a>
<a class="sourceLine" id="cb115-16" data-line-number="16">                        <span class="bu">print</span>(lower_list[<span class="dv">1</span>]<span class="op">+</span> <span class="st">&#39;</span><span class="ch">\t</span><span class="st">&#39;</span> <span class="op">+</span> <span class="bu">str</span>(index_int) <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\t</span><span class="st">&#39;</span> <span class="op">+</span> <span class="bu">file</span>[<span class="dv">22</span>:<span class="op">-</span><span class="dv">4</span>] <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\t</span><span class="st">&#39;</span> <span class="op">+</span> <span class="st">&#39;x&#39;</span> <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\t</span><span class="st">&#39;</span> <span class="op">+</span> <span class="st">&#39;header&#39;</span>, <span class="bu">file</span> <span class="op">=</span> log)</a>
<a class="sourceLine" id="cb115-17" data-line-number="17">                    <span class="cf">for</span> index, item <span class="kw">in</span> <span class="bu">enumerate</span>(lower_list):</a>
<a class="sourceLine" id="cb115-18" data-line-number="18">                        <span class="bu">next</span> <span class="op">=</span> index <span class="op">+</span> <span class="dv">1</span></a>
<a class="sourceLine" id="cb115-19" data-line-number="19">                        <span class="cf">if</span> <span class="bu">next</span> <span class="op">&lt;</span> <span class="bu">len</span>(lower_list):</a>
<a class="sourceLine" id="cb115-20" data-line-number="20">                            <span class="cf">if</span> item <span class="op">==</span> <span class="st">&#39;from&#39;</span>:</a>
<a class="sourceLine" id="cb115-21" data-line-number="21">                                <span class="cf">if</span> lower_list[index <span class="op">+</span><span class="dv">1</span>] <span class="kw">in</span> cityList:</a>
<a class="sourceLine" id="cb115-22" data-line-number="22">                                    <span class="bu">print</span>(lower_list[index <span class="op">+</span> <span class="dv">1</span>] <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\t</span><span class="st">&#39;</span> <span class="op">+</span> <span class="bu">str</span>(index_int) <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\t</span><span class="st">&#39;</span> <span class="op">+</span> <span class="bu">file</span>[<span class="dv">67</span>:<span class="op">-</span><span class="dv">4</span>] <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\t</span><span class="st">&#39;</span>, <span class="bu">next</span>, <span class="bu">file</span> <span class="op">=</span> log)</a>
<a class="sourceLine" id="cb115-23" data-line-number="23">                                    </a>
<a class="sourceLine" id="cb115-24" data-line-number="24">        <span class="cf">except</span>:</a>
<a class="sourceLine" id="cb115-25" data-line-number="25">            <span class="cf">pass</span></a></code></pre></div>
<p>Load libraries for making the bipartite network:</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb116-1" data-line-number="1"><span class="kw">library</span>(tidygraph)</a></code></pre></div>
<pre><code>## 
## Attaching package: &#39;tidygraph&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:stats&#39;:
## 
##     filter</code></pre>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb119-1" data-line-number="1"><span class="kw">library</span>(igraph)</a></code></pre></div>
<pre><code>## 
## Attaching package: &#39;igraph&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:tidygraph&#39;:
## 
##     groups</code></pre>
<pre><code>## The following objects are masked from &#39;package:purrr&#39;:
## 
##     compose, simplify</code></pre>
<pre><code>## The following object is masked from &#39;package:tidyr&#39;:
## 
##     crossing</code></pre>
<pre><code>## The following object is masked from &#39;package:tibble&#39;:
## 
##     as_data_frame</code></pre>
<pre><code>## The following object is masked from &#39;package:rgeos&#39;:
## 
##     union</code></pre>
<pre><code>## The following objects are masked from &#39;package:dplyr&#39;:
## 
##     as_data_frame, groups, union</code></pre>
<pre><code>## The following objects are masked from &#39;package:stats&#39;:
## 
##     decompose, spectrum</code></pre>
<pre><code>## The following object is masked from &#39;package:base&#39;:
## 
##     union</code></pre>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb129-1" data-line-number="1"><span class="kw">library</span>(ggraph)</a></code></pre></div>
<pre><code>## 
## Attaching package: &#39;ggraph&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:sp&#39;:
## 
##     geometry</code></pre>
<p>Load the file we’ve made with Python, get rid of the unnecessary fourth column, and have a look:</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb132-1" data-line-number="1">paragraphs_foreign &lt;-<span class="st"> </span><span class="kw">read.delim</span>(</a>
<a class="sourceLine" id="cb132-2" data-line-number="2">  <span class="st">&quot;paragraphs_foreign.tsv&quot;</span>, </a>
<a class="sourceLine" id="cb132-3" data-line-number="3">  <span class="dt">header=</span><span class="ot">FALSE</span>, </a>
<a class="sourceLine" id="cb132-4" data-line-number="4">  <span class="dt">stringsAsFactors=</span><span class="ot">FALSE</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">distinct</span>(V1,V2, V3, <span class="dt">.keep_all =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(V1, V2, V3, V5)</a>
<a class="sourceLine" id="cb132-5" data-line-number="5"><span class="kw">print</span>(<span class="kw">head</span>(paragraphs_foreign))</a></code></pre></div>
<pre><code>##          V1 V2           V3     V5
## 1     paris 10 PerfDiurn220 header
## 2 frankfort 15 PerfDiurn220 header
## 3 frankfort 15                    
## 4  scotland 19                    
## 5     leith 20 PerfDiurn220 header
## 6 edinburgh 26 PerfDiurn220 header</code></pre>
<p>Change the column names and keep only distinct rows - this is because our headers will also get picked up by the second part of the algorithm as in the code above. Also add ‘inner’ to the blank fields - now we know whether our location was a header (so a place of dispatch) or an inner (relay) place. Very useful.</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb134-1" data-line-number="1"><span class="kw">colnames</span>(paragraphs_foreign) =<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;place&#39;</span>, <span class="st">&#39;paragraph&#39;</span>, <span class="st">&#39;title&#39;</span>, <span class="st">&#39;type&#39;</span>)</a>
<a class="sourceLine" id="cb134-2" data-line-number="2"></a>
<a class="sourceLine" id="cb134-3" data-line-number="3">paragraphs_foreign =<span class="st"> </span>paragraphs_foreign <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">distinct</span>(place, paragraph, title, <span class="dt">.keep_all =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb134-4" data-line-number="4"></a>
<a class="sourceLine" id="cb134-5" data-line-number="5">paragraphs_foreign =<span class="st"> </span>paragraphs_foreign <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">type =</span> <span class="kw">replace</span>(type, type <span class="op">==</span><span class="st"> &#39;&#39;</span>, <span class="st">&#39;inner&#39;</span>))</a></code></pre></div>
</div>
<div id="mapping-locations" class="section level3">
<h3><span class="header-section-number">13.0.4</span> Mapping locations</h3>
<p>First we can map the places by volume of mentions, colour by type - whether they were a relay or first point of dispatch.</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb135-1" data-line-number="1">geoparsedfiles<span class="op">$</span>place =<span class="st"> </span><span class="kw">tolower</span>(geoparsedfiles<span class="op">$</span>place)</a></code></pre></div>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb136-1" data-line-number="1">paragraphs_foreign <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">left_join</span>(geoparsedfiles <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(<span class="kw">desc</span>(lng)) <span class="op">%&gt;%</span><span class="kw">distinct</span>(place, <span class="dt">.keep_all =</span> <span class="ot">TRUE</span>))</a></code></pre></div>
<pre><code>## Joining, by = &quot;place&quot;</code></pre>
<pre><code>##          place paragraph        title   type       lat       lng
## 1        paris        10 PerfDiurn220 header  40.40368 -80.51257
## 2    frankfort        15 PerfDiurn220 header  52.45750  -7.42056
## 3    frankfort        15               inner  52.45750  -7.42056
## 4     scotland        19               inner  41.69843 -72.08146
## 5        leith        20 PerfDiurn220 header  55.97130  -3.17230
## 6    edinburgh        26 PerfDiurn220 header -24.67740  31.22657
## 7        italy        30 PerfDiurn220 header  33.52183  36.28050
## 8        italy        30               inner  33.52183  36.28050
## 9       naples        30               inner  14.32771 120.97567
## 10      venice        31 PerfDiurn220 header  14.32641 120.97603
## 11      venice        31               inner  14.32641 120.97603
## 12     antwerp        40 PerfDiurn220 header  51.20900   4.43000
## 13      nantes        42               inner -24.07948  29.35000
## 14      london        42               inner -24.81927  31.04765
## 15    dalkeith        45 PerfDiurn220 header  55.89317  -3.06806
## 16    dalkeith        45               inner  55.89317  -3.06806
## 17       dover        57               inner  43.19786 -70.87367
## 18   frankfort        58 PerfDiurn221 header  52.45750  -7.42056
## 19   frankfort        58               inner  52.45750  -7.42056
## 20  regensburg        58               inner  49.01315  12.11190
## 21      venice        59 PerfDiurn221 header  14.32641 120.97603
## 22      venice        59               inner  14.32641 120.97603
## 23    dalmatia        59               inner  40.65425 -76.90248
## 24       milan        59               inner  41.29755 -82.60545
## 25    cagliari        59               inner -30.24671  27.03918
## 26       weems        64               inner  37.65486 -76.44384
## 27       leith        65 PerfDiurn221 header  55.97130  -3.17230
## 28       leith        65               inner  55.97130  -3.17230
## 29       paris        73 PerfDiurn221 header  40.40368 -80.51257
## 30        rome        73               inner  43.21285 -75.45573
## 31    brussels        74 PerfDiurn221 header  14.32037 120.95255
## 32    brussels        74               inner  14.32037 120.95255
## 33       leith        85 PerfDiurn221 header  55.97130  -3.17230
## 34     milford        87 PerfDiurn221 header  40.56871 -75.09462
## 35     milford        87               inner  40.56871 -75.09462
## 36    scotland        96               inner  41.69843 -72.08146
## 37    dalkeith        97 PerfDiurn223 header  55.89317  -3.06806
## 38   amsterdam       102 PerfDiurn223 header  14.34810 120.94402
## 39    eastland       104 PerfDiurn223 header  39.75455 -76.11523
## 40       paris       105 PerfDiurn223 header  40.40368 -80.51257
## 41       paris       105               inner  40.40368 -80.51257
## 42     alsatia       105               inner  32.61291 -91.18233
## 43    plymouth       118 PerfDiurn223 header  41.67204 -73.05289
## 44    plymouth       118               inner  41.67204 -73.05289
## 45        rome       121 PerfDiurn223 header  43.21285 -75.45573
## 46        rome       121               inner  43.21285 -75.45573
## 47      venice       123 PerfDiurn223 header  14.32641 120.97603
## 48      venice       123               inner  14.32641 120.97603
## 49    brussels       124               inner  14.32037 120.95255
## 50   inverness       126 PerfDiurn223 header  18.27531 -77.36862
## 51   inverness       126               inner  18.27531 -77.36862
## 52   inverness       127 PerfDiurn223 header  18.27531 -77.36862
## 53     england       128               inner  14.32689 120.97685
## 54     harwich       133               inner  42.38339 -82.03309
## 55    dalkeith       139               inner  55.89317  -3.06806
## 56      naples       141 PerfDiurn222 header  14.32771 120.97567
## 57      naples       141               inner  14.32771 120.97567
## 58      venice       141               inner  14.32641 120.97603
## 59   frankfort       142 PerfDiurn222 header  52.45750  -7.42056
## 60   frankfort       142               inner  52.45750  -7.42056
## 61      poland       142               inner  14.32581 120.97750
## 62  regensburg       143 PerfDiurn222 header  49.01315  12.11190
## 63  regensburg       143               inner  49.01315  12.11190
## 64       mylor       148 PerfDiurn222 header -35.04303 138.75900
## 65       mylor       148               inner -35.04303 138.75900
## 66       paris       155 PerfDiurn222 header  40.40368 -80.51257
## 67       paris       155               inner  40.40368 -80.51257
## 68    provence       155               inner  19.53333 -72.10000
## 69   luxemburg       156               inner  43.39589 -80.70690
## 70     antwerp       157 PerfDiurn222 header  51.20900   4.43000
## 71      venice       167 PerfDiurn222 header  14.32641 120.97603
## 72      venice       167               inner  14.32641 120.97603
## 73       genoa       167               inner  38.12203 -82.45987
## 74        rome       167               inner  43.21285 -75.45573
## 75       paris       168 PerfDiurn222 header  40.40368 -80.51257
## 76 scarborough       181 PerfDiurn222 header  18.30000 -77.38333
## 77   newcastle       181               inner  53.30111  -6.50222
## 78   amsterdam       182 PerfDiurn222 header  14.34810 120.94402
## 79       dover       183 PerfDiurn222 header  43.19786 -70.87367
## 80       leith       184 PerfDiurn222 header  55.97130  -3.17230
## 81    plymouth       193 PerfDiurn218 header  41.67204 -73.05289
## 82   stockholm       195               inner  14.34789 120.94408
## 83      naples       200 PerfDiurn218 header  14.32771 120.97567
## 84      naples       200               inner  14.32771 120.97567
## 85       paris       202 PerfDiurn218 header  40.40368 -80.51257
## 86       paris       223 PerfDiurn218 header  40.40368 -80.51257
## 87        rome       223               inner  43.21285 -75.45573
## 88     chester       226 PerfDiurn218 header  40.78427 -74.69683
## 89      dublin       226               inner  40.37177 -75.20156
## 90    falmouth       228 PerfDiurn218 header  18.47821 -77.65167
## 91    falmouth       228               inner  18.47821 -77.65167
## 92       cowes       228               inner  50.76306  -1.29772
## 93   edinburgh       231 PerfDiurn218 header -24.67740  31.22657</code></pre>
<p>Though it’s good at finding locations, the coordinates from the Edinburgh software are pretty terrible. We can do better with an off the shelf geocoder.</p>
<p>Geopy is a Python geocoder. Intructions on how to use it are here. You’ll need to sign up for a key for whichever geocoder you want to use (I use Bing, because it allows bulk geocoding with a free API). Your key would go after <code>api_key=</code></p>
<div class="sourceCode" id="cb139"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb139-1" data-line-number="1"><span class="im">from</span> functools <span class="im">import</span> partial</a>
<a class="sourceLine" id="cb139-2" data-line-number="2"></a>
<a class="sourceLine" id="cb139-3" data-line-number="3"><span class="im">import</span> pandas <span class="im">as</span> pd</a>
<a class="sourceLine" id="cb139-4" data-line-number="4">df <span class="op">=</span> pd.read_csv(<span class="st">&quot;places_foreign.csv&quot;</span>)</a>
<a class="sourceLine" id="cb139-5" data-line-number="5"></a>
<a class="sourceLine" id="cb139-6" data-line-number="6"><span class="im">from</span> geopy.point <span class="im">import</span> Point</a>
<a class="sourceLine" id="cb139-7" data-line-number="7"></a>
<a class="sourceLine" id="cb139-8" data-line-number="8">df <span class="op">=</span> df[<span class="st">&#39;place&#39;</span>].value_counts()</a>
<a class="sourceLine" id="cb139-9" data-line-number="9">df.to_csv(<span class="st">&#39;out.csv&#39;</span>)</a></code></pre></div>
<div class="sourceCode" id="cb140"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb140-1" data-line-number="1">df <span class="op">=</span> pd.read_csv(<span class="st">&quot;out.csv&quot;</span>, names<span class="op">=</span>[<span class="st">&#39;name&#39;</span>,<span class="st">&#39;amount&#39;</span>])</a>
<a class="sourceLine" id="cb140-2" data-line-number="2"></a>
<a class="sourceLine" id="cb140-3" data-line-number="3"><span class="im">from</span> geopy.geocoders <span class="im">import</span> Bing</a>
<a class="sourceLine" id="cb140-4" data-line-number="4">geolocator <span class="op">=</span> Bing(api_key<span class="op">=</span><span class="st">&quot;ApDo61amTsQG-fkx14lyuQw6ELnaxJScMTSYTXm-icu1VdHGkmIUDNdrxDUc0uOQ&quot;</span>)</a>
<a class="sourceLine" id="cb140-5" data-line-number="5"></a>
<a class="sourceLine" id="cb140-6" data-line-number="6"><span class="im">from</span> geopy.extra.rate_limiter <span class="im">import</span> RateLimiter</a>
<a class="sourceLine" id="cb140-7" data-line-number="7">geocode <span class="op">=</span> RateLimiter(geolocator.geocode, min_delay_seconds<span class="op">=</span>.<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb140-8" data-line-number="8"><span class="im">from</span> tqdm._tqdm_notebook <span class="im">import</span> tqdm_notebook</a>
<a class="sourceLine" id="cb140-9" data-line-number="9">tqdm_notebook.pandas(desc <span class="op">=</span> <span class="st">&quot;Geocoding locations:&quot;</span>)</a>
<a class="sourceLine" id="cb140-10" data-line-number="10">df[<span class="st">&#39;location&#39;</span>] <span class="op">=</span> df[<span class="st">&#39;name&#39;</span>].progress_apply(partial(geocode, user_location<span class="op">=</span>(Point(latitude<span class="op">=</span><span class="fl">53.5</span>, longitude<span class="op">=</span><span class="fl">2.4</span>)),culture<span class="op">=</span><span class="st">&#39;EN&#39;</span>))</a></code></pre></div>
<div class="sourceCode" id="cb141"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb141-1" data-line-number="1">df[<span class="st">&#39;point&#39;</span>] <span class="op">=</span> df[<span class="st">&#39;location&#39;</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> loc: <span class="bu">tuple</span>(loc.point) <span class="cf">if</span> loc <span class="cf">else</span> <span class="va">None</span>)</a>
<a class="sourceLine" id="cb141-2" data-line-number="2"></a>
<a class="sourceLine" id="cb141-3" data-line-number="3">df.to_csv(<span class="st">&#39;out.csv&#39;</span>)</a></code></pre></div>
<p>Load the geocoded points and do some processing:</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb142-1" data-line-number="1">points =<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&#39;out.csv&#39;</span>) </a></code></pre></div>
<pre><code>## Warning: Missing column names filled in: &#39;X1&#39; [1]</code></pre>
<pre><code>## Parsed with column specification:
## cols(
##   X1 = col_double(),
##   name = col_character(),
##   amount = col_double(),
##   location = col_character(),
##   point = col_character()
## )</code></pre>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb145-1" data-line-number="1"><span class="kw">colnames</span>(points)[<span class="dv">2</span>] =<span class="st"> &#39;place&#39;</span></a>
<a class="sourceLine" id="cb145-2" data-line-number="2"></a>
<a class="sourceLine" id="cb145-3" data-line-number="3">points<span class="op">$</span>place =<span class="st"> </span><span class="kw">tolower</span>(points<span class="op">$</span>place)</a>
<a class="sourceLine" id="cb145-4" data-line-number="4"></a>
<a class="sourceLine" id="cb145-5" data-line-number="5">points =<span class="st"> </span>points <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">point =</span> <span class="kw">str_replace</span>(point,<span class="st">&#39;</span><span class="ch">\\</span><span class="st">(&#39;</span>,<span class="st">&#39;&#39;</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">separate</span>(<span class="dt">col =</span> point, <span class="dt">into =</span> <span class="kw">c</span>(<span class="st">&#39;lat&#39;</span>,<span class="st">&#39;lng&#39;</span>), <span class="dt">sep =</span> <span class="st">&#39;,&#39;</span>)</a></code></pre></div>
<pre><code>## Warning: Expected 2 pieces. Additional pieces discarded in 259 rows [1, 2, 3, 4,
## 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, ...].</code></pre>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb147-1" data-line-number="1">paragraphs_foreign <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(place, type) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">tally</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">left_join</span>(points) </a></code></pre></div>
<pre><code>## Joining, by = &quot;place&quot;</code></pre>
<pre><code>## # A tibble: 56 x 8
## # Groups:   place [40]
##    place   type       n    X1 amount location            lat        lng         
##    &lt;chr&gt;   &lt;chr&gt;  &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;               &lt;chr&gt;      &lt;chr&gt;       
##  1 alsatia inner      1    71      2 London, England, U… 51.513000… &quot; -0.107000…
##  2 amster… header     2    27      3 Amsterdam, North H… 52.334800… &quot; 4.8705301…
##  3 antwerp header     2   247      1 Antwerp, Belgium    51.216999… &quot; 4.4000000…
##  4 brusse… header     1    32      3 Brussels Region, B… 50.836044… &quot; 4.3705911…
##  5 brusse… inner      2    32      3 Brussels Region, B… 50.836044… &quot; 4.3705911…
##  6 caglia… inner      1   251      1 Cagliari, Sard., I… 39.214538… &quot; 9.1104898…
##  7 chester header     1    53      2 Chester, England, … 53.188129… &quot; -2.894350…
##  8 cowes   inner      1    98      1 Cowes, England, Un… 50.758411… &quot; -1.297870…
##  9 dalkei… header     2     5      5 Dalkeith, Scotland… 55.892959… &quot; -3.068870…
## 10 dalkei… inner      2     5      5 Dalkeith, Scotland… 55.892959… &quot; -3.068870…
## # … with 46 more rows</code></pre>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb150-1" data-line-number="1"><span class="kw">library</span>(mapdata)</a></code></pre></div>
<p>Draw a blank map:</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb151-1" data-line-number="1">map =<span class="st"> </span><span class="kw">map_data</span>(<span class="st">&#39;world&#39;</span>)</a></code></pre></div>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb152-1" data-line-number="1"><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb152-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_polygon</span>(<span class="dt">data =</span> map, <span class="kw">aes</span>(<span class="dt">x =</span> long, <span class="dt">y =</span> lat, <span class="dt">group =</span> group), <span class="dt">fill =</span> <span class="st">&#39;gray50&#39;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb152-3" data-line-number="3"><span class="st">  </span><span class="kw">coord_fixed</span>(<span class="fl">1.3</span>, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">12</span>, <span class="dv">25</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">35</span>, <span class="dv">60</span>)) </a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-97-1.png" width="672" /></p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb153-1" data-line-number="1"><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb153-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_polygon</span>(<span class="dt">data =</span> map, <span class="kw">aes</span>(<span class="dt">x =</span> long, <span class="dt">y =</span> lat, <span class="dt">group =</span> group), <span class="dt">fill =</span> <span class="st">&#39;gray60&#39;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb153-3" data-line-number="3"><span class="st">  </span><span class="kw">coord_fixed</span>(<span class="fl">1.3</span>, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">12</span>, <span class="dv">25</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">35</span>, <span class="dv">60</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">data =</span> paragraphs_foreign <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(place, type) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb153-4" data-line-number="4"><span class="st">                                                                       </span><span class="kw">tally</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb153-5" data-line-number="5"><span class="st">                                                                       </span><span class="kw">left_join</span>(points), <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">as.numeric</span>(lng), <span class="dt">y =</span> <span class="kw">as.numeric</span>(lat), <span class="dt">size =</span> n, <span class="dt">fill =</span> type), <span class="dt">alpha =</span> <span class="fl">.6</span>, <span class="dt">color =</span> <span class="st">&#39;black&#39;</span>, <span class="dt">pch =</span> <span class="dv">21</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme_void</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb153-6" data-line-number="6"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&#39;bottom&#39;</span>)</a></code></pre></div>
<pre><code>## Joining, by = &quot;place&quot;</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-98-1.png" width="672" /></p>
</div>
<div id="bipartite-network" class="section level2">
<h2><span class="header-section-number">13.1</span> Bipartite network</h2>
<p>Now on to the network.</p>
<p>Make a unique code by concatenating the paragraph and title strings:</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb155-1" data-line-number="1">paragraphs_foreign<span class="op">$</span>code =<span class="st"> </span><span class="kw">paste0</span>(paragraphs_foreign<span class="op">$</span>paragraph, paragraphs_foreign<span class="op">$</span>title)</a></code></pre></div>
<p>Now we have a dataframe with geographic terms, each with a unique paragraph code, and information on whether they were in the header. Basically I’ve just invalidated the first six months of my PhD research.</p>
<p>Make our final file, which is just the placename and the unique paragraph code. Filter out ‘York’ and ‘Conde’ because although these are places, they are used much more to refer people in this set of newsbooks and throw off the data:</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb156-1" data-line-number="1">networkdf =<span class="st"> </span>paragraphs_foreign <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb156-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(place, code) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb156-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span>place <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;York&#39;</span>, <span class="st">&#39;Conde&#39;</span>))</a>
<a class="sourceLine" id="cb156-4" data-line-number="4"><span class="kw">head</span>(networkdf)</a></code></pre></div>
<pre><code>##       place           code
## 1     paris 10PerfDiurn220
## 2 frankfort 15PerfDiurn220
## 3 frankfort             15
## 4  scotland             19
## 5     leith 20PerfDiurn220
## 6 edinburgh 26PerfDiurn220</code></pre>
<p>Time to make a bipartite network as described here, using igraph: <a href="https://rpubs.com/pjmurphy/317838" class="uri">https://rpubs.com/pjmurphy/317838</a></p>
<p>A bipartite network is one in which the elements are connected because they share a common property. So in this example, our elements are cities, connected because they share a paragraph.</p>
<p>First make a regular igraph network:</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb158-1" data-line-number="1">g =<span class="st"> </span><span class="kw">graph.data.frame</span>(networkdf, <span class="dt">directed=</span><span class="ot">FALSE</span>)</a></code></pre></div>
<p>Next we make the bipartite matrix</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb159-1" data-line-number="1"><span class="kw">V</span>(g)<span class="op">$</span>type &lt;-<span class="st"> </span><span class="kw">bipartite_mapping</span>(g)<span class="op">$</span>type</a>
<a class="sourceLine" id="cb159-2" data-line-number="2">bipartite_matrix &lt;-<span class="st"> </span><span class="kw">as_incidence_matrix</span>(g)</a>
<a class="sourceLine" id="cb159-3" data-line-number="3">title_matrix_prod &lt;-<span class="st"> </span><span class="kw">t</span>(bipartite_matrix) <span class="op">%*%</span><span class="st"> </span>bipartite_matrix</a></code></pre></div>
<p>This creates a matrix with each place in each row and each column. The numbers represent the times they were mentioned in the same paragraph. We can see, for example, that Paris and Flanders were mentioned 4 times together, but Paris and Scotland only once. When we go to draw the network, Paris will be placed closer to Flanders than to Scotland.</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb160-1" data-line-number="1">place_matrix_prod &lt;-<span class="st"> </span>bipartite_matrix <span class="op">%*%</span><span class="st"> </span><span class="kw">t</span>(bipartite_matrix)</a>
<a class="sourceLine" id="cb160-2" data-line-number="2">place_matrix_prod &lt;-<span class="st"> </span>bipartite_matrix <span class="op">%*%</span><span class="st"> </span><span class="kw">t</span>(bipartite_matrix)</a>
<a class="sourceLine" id="cb160-3" data-line-number="3"><span class="kw">diag</span>(place_matrix_prod) &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb160-4" data-line-number="4">place_matrix_prod[<span class="kw">order</span>(place_matrix_prod[,<span class="dv">1</span>], <span class="dt">decreasing =</span> <span class="ot">TRUE</span>),][<span class="dv">0</span><span class="op">:</span><span class="dv">10</span>,<span class="dv">0</span><span class="op">:</span><span class="dv">10</span>]</a></code></pre></div>
<pre><code>##           paris frankfort scotland leith edinburgh italy naples venice antwerp
## alsatia       1         0        0     0         0     0      0      0       0
## provence      1         0        0     0         0     0      0      0       0
## paris         0         0        0     0         0     0      0      0       0
## frankfort     0         0        0     0         0     0      0      0       0
## scotland      0         0        0     0         0     0      0      0       0
## leith         0         0        0     0         0     0      0      0       0
## edinburgh     0         0        0     0         0     0      0      0       0
## italy         0         0        0     0         0     0      1      0       0
## naples        0         0        0     0         0     1      0      1       0
## venice        0         0        0     0         0     0      1      0       0
##           nantes
## alsatia        0
## provence       0
## paris          0
## frankfort      0
## scotland       0
## leith          0
## edinburgh      0
## italy          0
## naples         0
## venice         0</code></pre>
<p>This turns the matrix into a network graph object:</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb162-1" data-line-number="1">places_overlap &lt;-<span class="st"> </span><span class="kw">graph_from_adjacency_matrix</span>(place_matrix_prod,</a>
<a class="sourceLine" id="cb162-2" data-line-number="2"><span class="dt">mode =</span> <span class="st">&quot;undirected&quot;</span>,</a>
<a class="sourceLine" id="cb162-3" data-line-number="3"><span class="dt">weighted =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p>This turns the network graph object into a tidygraph object, which I find easier to work with.</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb163-1" data-line-number="1">tg =<span class="st"> </span><span class="kw">as_tbl_graph</span>(places_overlap)</a>
<a class="sourceLine" id="cb163-2" data-line-number="2">tg</a></code></pre></div>
<pre><code>## # A tbl_graph: 40 nodes and 17 edges
## #
## # An undirected simple graph with 27 components
## #
## # Node Data: 40 x 1 (active)
##   name     
##   &lt;chr&gt;    
## 1 paris    
## 2 frankfort
## 3 scotland 
## 4 leith    
## 5 edinburgh
## 6 italy    
## # … with 34 more rows
## #
## # Edge Data: 17 x 3
##    from    to weight
##   &lt;int&gt; &lt;int&gt;  &lt;dbl&gt;
## 1     1    24      1
## 2     1    31      1
## 3     2    14      1
## # … with 14 more rows</code></pre>
<p>Draw the network diagram:</p>
<p>Unsurprisingly, places associated with each other are placed close together. Stockholm, Gothenburg, and Frankfurt form a separate group, for example. Points are sized by their overall connections: Paris and London have the most, and are at the centre.</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb165-1" data-line-number="1"> tg <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb165-2" data-line-number="2"><span class="st">  </span><span class="kw">activate</span>(nodes) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb165-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">degree =</span> <span class="kw">centrality_degree</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb165-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">group_lv =</span> <span class="kw">group_louvain</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb165-5" data-line-number="5"><span class="st">  </span><span class="kw">filter</span>(degree<span class="op">&gt;</span><span class="dv">0</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb165-6" data-line-number="6"><span class="st">  </span><span class="kw">ggraph</span>(<span class="dt">layout =</span> <span class="st">&#39;nicely&#39;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb165-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_node_point</span>(<span class="dt">alpha =</span> <span class="fl">.5</span>, </a>
<a class="sourceLine" id="cb165-8" data-line-number="8">                  <span class="dt">pch =</span> <span class="dv">21</span>,</a>
<a class="sourceLine" id="cb165-9" data-line-number="9">                  <span class="dt">color =</span> <span class="st">&#39;black&#39;</span>,</a>
<a class="sourceLine" id="cb165-10" data-line-number="10">                  <span class="kw">aes</span>(<span class="dt">size =</span> degree,</a>
<a class="sourceLine" id="cb165-11" data-line-number="11">                      <span class="dt">fill =</span> <span class="kw">factor</span>(group_lv)))<span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb165-12" data-line-number="12"><span class="st">    </span><span class="kw">geom_edge_link</span>(<span class="dt">alpha =</span> <span class="fl">.1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb165-13" data-line-number="13"><span class="st">  </span><span class="kw">geom_node_text</span>(<span class="dt">alpha =</span> <span class="fl">.8</span>, </a>
<a class="sourceLine" id="cb165-14" data-line-number="14">                 <span class="kw">aes</span>(<span class="dt">size =</span> degree, </a>
<a class="sourceLine" id="cb165-15" data-line-number="15">                     <span class="dt">label =</span><span class="kw">ifelse</span>(degree <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, </a>
<a class="sourceLine" id="cb165-16" data-line-number="16">                                   <span class="kw">as.character</span>(name), </a>
<a class="sourceLine" id="cb165-17" data-line-number="17">                                   <span class="ot">NA_character_</span>)), </a>
<a class="sourceLine" id="cb165-18" data-line-number="18">                 <span class="dt">repel =</span> <span class="ot">FALSE</span>, </a>
<a class="sourceLine" id="cb165-19" data-line-number="19">                 <span class="dt">show.legend =</span> <span class="ot">FALSE</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb165-20" data-line-number="20"><span class="st">  </span><span class="kw">scale_size_area</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb165-21" data-line-number="21"><span class="st">  </span><span class="kw">theme_void</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb165-22" data-line-number="22"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&#39;right&#39;</span>)</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-106-1.png" width="672" /></p>
<p>I think this has actually done an amazing job - it’s really similar to the network I made with manual data. Important places are in the centre, and some connecting cities (Madrid, Genoa, Venice, for example) are really obvious in the network.</p>
<p>Tidygraph allows for lots of easy calculations of network metrics - here I’ve plotted the total connections - here’s the top 20:</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb166-1" data-line-number="1">tg <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb166-2" data-line-number="2"><span class="st">  </span><span class="kw">activate</span>(edges) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb166-3" data-line-number="3"><span class="st">  </span><span class="kw">activate</span>(nodes) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb166-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">degree =</span> <span class="kw">centrality_degree</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb166-5" data-line-number="5"><span class="st">  </span><span class="kw">as.data.frame</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb166-6" data-line-number="6"><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(degree)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="dv">20</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb166-7" data-line-number="7"><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st">  </span></a>
<a class="sourceLine" id="cb166-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">reorder</span>(name, degree), <span class="dt">y =</span> degree), <span class="dt">stat =</span> <span class="st">&#39;identity&#39;</span>, <span class="dt">fill =</span> <span class="st">&#39;lightblue&#39;</span>, <span class="dt">color =</span> <span class="st">&#39;black&#39;</span>, <span class="dt">alpha =</span> <span class="fl">.8</span>) <span class="op">+</span><span class="st"> </span><span class="kw">coord_flip</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme_minimal</span>() <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;1654 newsbook locations, ranked by connections (degree):&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.title.y =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-108-1.png" width="672" />
Here’s a plot of another measure of centrality, betweenness, which measures how like a node is to be used as a path between all other pairs of nodes.</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb167-1" data-line-number="1">tg <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb167-2" data-line-number="2"><span class="st">  </span><span class="kw">activate</span>(edges) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb167-3" data-line-number="3"><span class="st">  </span><span class="kw">activate</span>(nodes) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb167-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">between =</span> <span class="kw">centrality_betweenness</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb167-5" data-line-number="5"><span class="st">  </span><span class="kw">as.data.frame</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb167-6" data-line-number="6"><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(between)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb167-7" data-line-number="7"><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st">  </span></a>
<a class="sourceLine" id="cb167-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">reorder</span>(name, between), <span class="dt">y =</span> between), <span class="dt">stat =</span> <span class="st">&#39;identity&#39;</span>, <span class="dt">fill =</span> <span class="st">&#39;lightblue&#39;</span>, <span class="dt">color =</span> <span class="st">&#39;black&#39;</span>, <span class="dt">alpha =</span> <span class="fl">.8</span>) <span class="op">+</span><span class="st"> </span><span class="kw">coord_flip</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme_minimal</span>() <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;1654 newsbook locations, ranked by betweenness:&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.title.y =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-109-1.png" width="672" /></p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb168-1" data-line-number="1">tg <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb168-2" data-line-number="2"><span class="st">  </span><span class="kw">activate</span>(nodes) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb168-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">degree =</span> <span class="kw">centrality_degree</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb168-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">group_lv =</span> <span class="kw">group_louvain</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb168-5" data-line-number="5"><span class="st">  </span><span class="kw">left_join</span>(tg <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb168-6" data-line-number="6"><span class="st">  </span><span class="kw">activate</span>(nodes) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb168-7" data-line-number="7"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">degree =</span> <span class="kw">centrality_degree</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb168-8" data-line-number="8"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">group_lv =</span> <span class="kw">group_louvain</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb168-9" data-line-number="9"><span class="st">           </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(group_lv) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb168-10" data-line-number="10"><span class="st">    </span><span class="kw">tally</span>() )<span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb168-11" data-line-number="11"><span class="st">  </span><span class="kw">filter</span>(n<span class="op">&gt;</span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">left_join</span>(points, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&#39;name&#39;</span> =<span class="st"> &#39;place&#39;</span>))</a></code></pre></div>
<pre><code>## Joining, by = &quot;group_lv&quot;</code></pre>
<pre><code>## # A tibble: 18 x 9
##    name    degree group_lv     n    X1 amount location        lat      lng      
##    &lt;chr&gt;    &lt;dbl&gt;    &lt;int&gt; &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;           &lt;chr&gt;    &lt;chr&gt;    
##  1 paris        2        3     3     4      5 Paris, IdF, Fr… 48.8571… &quot; 2.3413…
##  2 frankf…      2        2     3    48      2 Frankfort, KY,… 38.1950… &quot; -84.87…
##  3 italy        1        4     2    46      2 Italy           43.5290… &quot; 12.162…
##  4 naples       2        4     2     3      5 Naples, Camp.,… 40.8401… &quot; 14.252…
##  5 venice       6        1     6     2      5 Venice, Ven., … 45.4381… &quot; 12.318…
##  6 nantes       1        5     2    63      2 Nantes, Pays d… 47.2181… &quot; -1.553…
##  7 london       1        5     2    14      4 London, Englan… 51.5064… &quot; -0.127…
##  8 regens…      1        2     3    10      4 Regensburg, BY… 49.0149… &quot; 12.101…
##  9 dalmat…      3        1     6    30      3 Dalmatia, PA, … 40.6465… &quot; -76.90…
## 10 milan        3        1     6    16      4 Milan, Lomb., … 45.4679… &quot; 9.1817…
## 11 caglia…      3        1     6   251      1 Cagliari, Sard… 39.2145… &quot; 9.1104…
## 12 rome         2        1     6    17      4 Rome, Laz., It… 41.9032… &quot; 12.495…
## 13 alsatia      1        3     3    71      2 London, Englan… 51.5130… &quot; -0.107…
## 14 poland       1        2     3    13      4 Poland          52.1290… &quot; 19.393…
## 15 proven…      1        3     3   182      1 Provence, VD, … 46.8914… &quot; 6.7277…
## 16 genoa        2        1     6   143      1 Genoa, Lig., I… 44.4103… &quot; 8.9389…
## 17 falmou…      1        6     2   243      1 Falmouth, Engl… 50.1522… &quot; -5.079…
## 18 cowes        1        6     2    98      1 Cowes, England… 50.7584… &quot; -1.297…</code></pre>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb171-1" data-line-number="1"><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb171-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_polygon</span>(<span class="dt">data =</span> map, <span class="kw">aes</span>(<span class="dt">x =</span> long, <span class="dt">y =</span> lat, <span class="dt">group =</span> group), <span class="dt">fill =</span> <span class="st">&#39;gray60&#39;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb171-3" data-line-number="3"><span class="st">  </span><span class="kw">coord_fixed</span>(<span class="fl">1.3</span>, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">12</span>, <span class="dv">25</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">35</span>, <span class="dv">60</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">data =</span> tg <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb171-4" data-line-number="4"><span class="st">  </span><span class="kw">activate</span>(nodes) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb171-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">degree =</span> <span class="kw">centrality_degree</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb171-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">group_lv =</span> <span class="kw">group_louvain</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb171-7" data-line-number="7"><span class="st">  </span><span class="kw">left_join</span>(tg <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb171-8" data-line-number="8"><span class="st">  </span><span class="kw">activate</span>(nodes) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb171-9" data-line-number="9"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">degree =</span> <span class="kw">centrality_degree</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb171-10" data-line-number="10"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">group_lv =</span> <span class="kw">group_louvain</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb171-11" data-line-number="11"><span class="st">           </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(group_lv) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb171-12" data-line-number="12"><span class="st">    </span><span class="kw">tally</span>() )<span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb171-13" data-line-number="13"><span class="st">  </span><span class="kw">filter</span>(n<span class="op">&gt;</span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">left_join</span>(points, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&#39;name&#39;</span> =<span class="st"> &#39;place&#39;</span>)), <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">as.numeric</span>(lng), <span class="dt">y =</span> <span class="kw">as.numeric</span>(lat), <span class="dt">size =</span> degree, <span class="dt">fill =</span> <span class="kw">factor</span>(group_lv)), <span class="dt">alpha =</span> <span class="fl">.6</span>, <span class="dt">color =</span> <span class="st">&#39;black&#39;</span>, <span class="dt">pch =</span> <span class="dv">21</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb171-14" data-line-number="14"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&#39;bottom&#39;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">geom_text</span>(<span class="dt">data =</span> tg <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb171-15" data-line-number="15"><span class="st">  </span><span class="kw">activate</span>(nodes) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb171-16" data-line-number="16"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">degree =</span> <span class="kw">centrality_degree</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb171-17" data-line-number="17"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">group_lv =</span> <span class="kw">group_louvain</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb171-18" data-line-number="18"><span class="st">  </span><span class="kw">left_join</span>(tg <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb171-19" data-line-number="19"><span class="st">  </span><span class="kw">activate</span>(nodes) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb171-20" data-line-number="20"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">degree =</span> <span class="kw">centrality_degree</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb171-21" data-line-number="21"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">group_lv =</span> <span class="kw">group_louvain</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb171-22" data-line-number="22"><span class="st">           </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(group_lv) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb171-23" data-line-number="23"><span class="st">    </span><span class="kw">tally</span>() )<span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb171-24" data-line-number="24"><span class="st">  </span><span class="kw">filter</span>(n<span class="op">&gt;</span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb171-25" data-line-number="25"><span class="st">    </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb171-26" data-line-number="26"><span class="st">    </span><span class="kw">left_join</span>(points, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&#39;name&#39;</span> =<span class="st"> &#39;place&#39;</span>)),</a>
<a class="sourceLine" id="cb171-27" data-line-number="27">  <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">as.numeric</span>(lng),</a>
<a class="sourceLine" id="cb171-28" data-line-number="28">      <span class="dt">y =</span> <span class="kw">as.numeric</span>(lat), </a>
<a class="sourceLine" id="cb171-29" data-line-number="29">      <span class="dt">size =</span> degree, <span class="dt">label =</span> name), </a>
<a class="sourceLine" id="cb171-30" data-line-number="30">  <span class="dt">alpha =</span> <span class="fl">.6</span>, </a>
<a class="sourceLine" id="cb171-31" data-line-number="31">  <span class="dt">color =</span> <span class="st">&#39;black&#39;</span>, </a>
<a class="sourceLine" id="cb171-32" data-line-number="32">  <span class="dt">pch =</span> <span class="dv">21</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb171-33" data-line-number="33"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&#39;bottom&#39;</span>)</a></code></pre></div>
<pre><code>## Joining, by = &quot;group_lv&quot;Joining, by = &quot;group_lv&quot;</code></pre>
<pre><code>## Warning: Ignoring unknown parameters: shape</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-111-1.png" width="672" /></p>

<div id="refs" class="references">
<div>
<p>King, Ed, ‘British Library Digitisation: Access and Copyright’, 2008</p>
</div>
<div>
<p>———, ‘Digitisation of British Newspapers 1800-1900’, 2007 &lt;<a href="https://www.gale.com/intl/essays/ed-king-digitisation-of-british-newspapers-1800-1900">https://www.gale.com/intl/essays/ed-king-digitisation-of-british-newspapers-1800-1900</a>&gt; [accessed 2007]</p>
</div>
<div>
<p>Mussell, James, ‘Elemental Forms: Elemental Forms: The Newspaper as Popular Genre in the Nineteenth Century’, <em>Media History</em>, 20.1 (2014), 4–20 &lt;<a href="https://doi.org/10.1080/13688804.2014.880264">https://doi.org/10.1080/13688804.2014.880264</a>&gt;</p>
</div>
<div>
<p>Shaw, Jane, ‘10 Billion Words: The British Library British Newspapers 1800-1900 Project: Some Guidelines for Large-Scale Newspaper Digitisation’, 2005 &lt;<a href="https://archive.ifla.org/IV/ifla71/papers/154e-Shaw.pdf">https://archive.ifla.org/IV/ifla71/papers/154e-Shaw.pdf</a>&gt;</p>
</div>
<div>
<p>———, ‘Selection of Newspapers’, <em>British Library Newspapers</em>, 2007 &lt;<a href="https://www.gale.com/intl/essays/jane-shaw-selection-of-newspapers">https://www.gale.com/intl/essays/jane-shaw-selection-of-newspapers</a>&gt;</p>
</div>
<div>
<p>Smits, Thomas, ‘Making the News National: Using Digitized Newspapers to Study the Distribution of the Queen’s Speech by W. H. Smith &amp; Son, 1846–1858’, <em>Victorian Periodicals Review</em>, 49.4 (2016), 598–625 &lt;<a href="https://doi.org/10.1353/vpr.2016.0041">https://doi.org/10.1353/vpr.2016.0041</a>&gt;</p>
</div>
</div>
</div>
</div>












            </section>

          </div>
        </div>
      </div>
<a href="ocr-and-its-problems.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
